{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/benjamindesole/Documents/GitHub/boite-a-recettes/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from'react';import AjouterRecette from'./AjouterRecette';import AdminForm from'./AdminForm';import Login from'./Login';import firebase from'firebase/app';import'firebase/auth';import base,{firebaseApp}from'../base';var Admin=/*#__PURE__*/function(_Component){_inherits(Admin,_Component);var _super=_createSuper(Admin);function Admin(){var _this;_classCallCheck(this,Admin);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={uid:null,chef:null};_this.handleAuth=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(authData){var box;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return base.fetch(_this.props.pseudo,{context:_assertThisInitialized(_this)});case 2:box=_context.sent;if(box.chef){_context.next=6;break;}_context.next=6;return base.post(\"\".concat(_this.props.pseudo,\"/chef\"),{data:authData.user.uid});case 6:_this.setState({uid:authData.user.uid,chef:box.chef||authData.user.uid});case 7:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.authenticate=function(){var authProvider=new firebase.auth.FacebookAuthProvider();firebaseApp.auth().signInWithPopup(authProvider).then(_this.handleAuth);};_this.logout=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log('Déconnexion');_context2.next=3;return firebase.auth().signOut();case 3:_this.setState({uid:null});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _this;}_createClass(Admin,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;firebase.auth().onAuthStateChanged(function(user){if(user){_this2.handleAuth({user:user});}});}},{key:\"render\",value:function render(){var _this$props=this.props,recettes=_this$props.recettes,ajouterRecette=_this$props.ajouterRecette,majRecette=_this$props.majRecette,chargerExemple=_this$props.chargerExemple,supprimerRecette=_this$props.supprimerRecette;var logout=/*#__PURE__*/_jsx(\"button\",{onClick:this.logout,children:\"D\\xE9cconnexion\"});// si user non connecté\nif(!this.state.uid){return/*#__PURE__*/_jsx(Login,{authenticate:this.authenticate});}if(this.state.uid!==this.state.chef){return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"Tu n'es pas le chef de cette boite !\"}),logout]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"cards\",children:[/*#__PURE__*/_jsx(AjouterRecette,{ajouterRecette:ajouterRecette}),Object.keys(recettes).map(function(key){return/*#__PURE__*/_jsx(AdminForm,{id:key,majRecette:majRecette,supprimerRecette:supprimerRecette,recettes:recettes},key);}),/*#__PURE__*/_jsxs(\"footer\",{children:[logout,/*#__PURE__*/_jsx(\"button\",{onClick:chargerExemple,children:\"Remplir\"})]})]});}}]);return Admin;}(Component);export default Admin;","map":{"version":3,"sources":["/Users/benjamindesole/Documents/GitHub/boite-a-recettes/src/components/Admin.js"],"names":["React","Component","AjouterRecette","AdminForm","Login","firebase","base","firebaseApp","Admin","state","uid","chef","handleAuth","authData","fetch","props","pseudo","context","box","post","data","user","setState","authenticate","authProvider","auth","FacebookAuthProvider","signInWithPopup","then","logout","console","log","signOut","onAuthStateChanged","recettes","ajouterRecette","majRecette","chargerExemple","supprimerRecette","Object","keys","map","key"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport AjouterRecette from './AjouterRecette'\nimport AdminForm from './AdminForm'\nimport Login from './Login'\n\nimport firebase from 'firebase/app'\nimport 'firebase/auth'\nimport base, { firebaseApp } from '../base'\n\nclass Admin extends Component {\n    state = {\n        uid: null,\n        chef : null\n    }\n\n    componentDidMount() {\n        firebase.auth().onAuthStateChanged(user => {\n            if (user) {\n                this.handleAuth({ user })\n            }\n        })\n    }\n\n    handleAuth = async authData => {\n        const box = await base.fetch(this.props.pseudo, { context: this })\n\n        if (!box.chef) {\n            await base.post(`${this.props.pseudo}/chef`, {\n                data: authData.user.uid\n            })\n        }\n\n        this.setState({\n            uid: authData.user.uid,\n            chef: box.chef || authData.user.uid\n        })\n    }\n\n    authenticate = () => {\n        const authProvider = new firebase.auth.FacebookAuthProvider()\n        firebaseApp\n            .auth()\n            .signInWithPopup(authProvider)\n            .then(this.handleAuth)\n    }\n\n    logout = async () => {\n        console.log('Déconnexion')\n        await firebase.auth().signOut()\n        this.setState({ uid: null })\n    }\n\n    render() {\n        const { recettes, ajouterRecette, majRecette, chargerExemple, supprimerRecette } = this.props\n\n        const logout = <button onClick={this.logout}>Décconnexion</button>\n\n        // si user non connecté\n        if (!this.state.uid) {\n            return <Login authenticate={this.authenticate} />\n        }\n\n        if (this.state.uid !== this.state.chef) {\n            return(\n                <div>\n                    <p>Tu n'es pas le chef de cette boite !</p>\n                    {logout}\n                </div>\n            )\n        }\n\n        return(\n            <div className=\"cards\">\n                <AjouterRecette ajouterRecette={ajouterRecette} />\n                {\n                    Object.keys(recettes)\n                    .map(key => <AdminForm\n                        key={key}\n                        id={key}\n                        majRecette={majRecette}\n                        supprimerRecette={supprimerRecette}\n                        recettes={recettes} />)\n                }\n                <footer>\n                    {logout}\n                    <button onClick={chargerExemple}>Remplir</button>\n                </footer>\n            </div>\n        )\n    }\n}\n\nexport default Admin"]},"metadata":{},"sourceType":"module"}